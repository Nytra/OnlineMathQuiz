<!DOCTYPE html>
<html>
    <head>
        <title>Sam's Math Quiz</title>
        <link rel="stylesheet" href="style.css">
        <script type="text/javascript">
            function submit() {
                let questions = document.getElementsByClassName("question")
                let reArith = /\d*[+-/*x]\d*/; // for detecting standard arithmetic questions
                let reTrig = /^\b(sin|cos|tan)\b/; // for detecting trigonometry questions

                let operators = ['+', '-', '/', 'x']; // we will always display 'x' instead of '*'
                let TO_RAD = 3.14 / 180;

                let numCorrect = 0;

                // ToDo:
                // Get operands and operator of the math problem
                // check values of inputs against math problem evaluation.

                for (let i = 0; i < questions.length; i++) {
                    let questionId = questions[i].getAttribute("name");
                    let children = questions[i].childNodes;
                    let mathProblem = "";

                    let isTrig = false;
                    let isArith = false;

                    // we will evaluate this later
                    let correctAnswer = null;
                    let userAnswer = null;

                    for (let j = 0; j < children.length; j++) {
                        
                        // check the math problem in H2 for regular expression match
                        if (children[j].tagName == "H2" && mathProblem == "") {
                            let innerHTML = children[j].innerHTML;

                            // iterate through math problem string
                            for (let k = 0; k < innerHTML.length; k++) {
                                
                                // remove spaces from math problem
                                if (innerHTML[k] != ' ') {
                                    mathProblem += innerHTML[k];
                                }
                            }                                    
                            
                            // check arithmetic match
                            if (reArith.test(mathProblem)) {
                                isArith = true;
                            }

                            // check trig match
                            if (reTrig.test(mathProblem)) {
                                isTrig = true;
                            }
                            // maybe reset j
                        }

                        else if (children[j].tagName == "INPUT" && children[j].checked && userAnswer == null) {
                            //userAnswer = children[j].innerHTML;
                            //console.log("userAnswer: " + userAnswer);
                            selectedId = children[j].id;
                            //console.log(selectedId);
                            // find the label with 'for' attribute as '#id'
                            //let labels = document.getElementById(selectedId);
                            for (let k = 0; k < children.length; k++) {
                                if (children[k].tagName == "LABEL" && children[k].getAttribute("for") == '#' + selectedId) {
                                    //console.log(children[k].innerHTML);
                                    //console.log(children[k]);
                                    userAnswer = children[k].innerHTML; 
                                    //userAnswer = children[k].textContent; 
                                }
                            }
                        }
                        
                    }

                    if (isTrig == true && correctAnswer == null) {
                            let parts = mathProblem.split("(");
                            let value = Number(parts[1].substring(0, parts[1].length - 1));
                            let func = parts[0];                            
                            //let result = null;

                            switch(func) {
                                case "sin":
                                    correctAnswer = Math.sin(value * TO_RAD).toFixed(1);
                                    break;
                                case "cos":                                
                                    correctAnswer = Math.cos(value * TO_RAD).toFixed(1);
                                    break;
                                case "tan":                                    
                                    correctAnswer = Math.tan(value * TO_RAD).toFixed(1);
                                    break;
                                default:
                                    // this should never execute because of the regular expression check
                                    console.log("error: unknown trig function");
                            }

                            // we have the result of the trig function
                            if (correctAnswer != null) {
                                //console.log("result: " + correctAnswer);
                            }
                    }
                    else if (isArith == true && correctAnswer == null) {
                        // extract the two operands and the operator
                        let operator = null;
                        for (let k = 0; k < operators.length; k++) {
                            if (mathProblem.includes(operators[k])) {
                                //console.log("problem contains: " + operators[k]);
                                operator = operators[k];
                                break;
                            }
                        }
                        if (operator != null) {
                            let num1 = mathProblem.split(operator)[0];
                            let num2 = mathProblem.split(operator)[1];
                            
                            switch(operator) {
                                case "+":
                                    correctAnswer = Number(num1) + Number(num2);
                                    break;
                                case "-":
                                    correctAnswer = Number(num1) - Number(num2);
                                    break;
                                case "x":
                                    correctAnswer = Number(num1) * Number(num2);
                                    break;
                                case "/":
                                    correctAnswer = Number(num1) / Number(num2);
                                    break;
                            }

                            if (correctAnswer != null) {
                                //console.log("result: " + correctAnswer);
                            }
                        }
                    }

                    // clean user answer if contains fraction html or forward-slash
                    //console.log(userAnswer);
                    if (userAnswer.includes("/") && !(userAnswer.includes("<") || userAnswer.includes(">"))) {
                        let num1 = userAnswer.split("/")[0];
                        let num2 = userAnswer.split("/")[1];
                        userAnswer = num1 / num2;
                    }
                    else if (userAnswer.includes("<msqrt>")) {
                        let sqrtNum = userAnswer.split("<mi>")[1].split("</mi>")[0];
                        let otherNum = userAnswer.split("</math>/")[1];
                        //console.log("to sqrt: " + sqrtNum);
                        //console.log("to divide: " + otherNum);
                        if (otherNum != undefined) {
                            userAnswer = Math.sqrt(sqrtNum) / otherNum; 
                        }
                        else {
                            userAnswer = Math.sqrt(sqrtNum);
                        }
                    }

                    // check if userAnswer matches correctAnswer
                    if (userAnswer == Number(correctAnswer)) {
                        console.log("correct: " + userAnswer + "=" + correctAnswer);
                        numCorrect += 1;
                    }
                    else {
                        console.log("incorrect: " + userAnswer + "!=" + correctAnswer);
                    }

                    document.getElementById("resultLabel").innerHTML = "Result: " + numCorrect + '/' + questions.length;

                }

                return;







                let questionNames = [];

                for (let i = 0; i < questions.length; i++) {
                    questionNames[i] = questions[i].getAttribute("name");
                }
                console.log(questionNames);

                //let numCorrect = 0;
                for (let i = 0; i < questionNames.length; i++) {
                    let questionName = questionNames[i];
                    let question = document.getElementsByName(questionName);
                    for (let j = 0; j < question.length; j++) {
                        let questionId = question[j].id;
                        if (question[j].checked) {
                            if (questionName == "q1" && questionId == "q1-2") {
                                numCorrect += 1;
                            }
                            else if (questionName == "q2" && questionId == "q2-3") {
                                numCorrect += 1;
                            }
                            else if (questionName == "q3" && questionId == "q3-1") {
                                numCorrect += 1;
                            }
                            else if (questionName == "q4" && questionId == "q4-2") {
                                numCorrect += 1;
                            }
                        }
                    }
                }

                let out = numCorrect + "/" + questionNames.length;
                console.log(out);
                document.getElementById("resultLabel").innerHTML = "Result: " + out;
            }
        </script>
    </head>

    <body>
        <div class="header">
            <h1>Sam's Math Quiz</h1>
        </div>
        <hr>
        <div class="info">
            <h2>Try to answer these questions correctly!</h2>
        </div>
        <div class="quizBlock">
            <div class="question" name="q1">
                <h2>2 + 2</h2>
                <label for="#q1-1">6</label>
                <input type="radio" name="q1" id="q1-1"> <br/>
                <label for="#q1-2">4</label>
                <input type="radio" name="q1" id="q1-2"> <br/>
                <label for="#q1-3">5</label>
                <input type="radio" name="q1" id="q1-3"> <br/>
            </div>
            <div class="question" name="q2">
                <h2>9 x 7</h2>
                <label for="#q2-1">56</label>
                <input type="radio" name="q2" id="q2-1"> <br/>
                <label for="#q2-2">61</label>
                <input type="radio" name="q2" id="q2-2"> <br/>
                <label for="#q2-3">63</label>
                <input type="radio" name="q2" id="q2-3"> <br/>
            </div>
            <div class="question", name="q3">
                <h2>cos(60)</h2>
                <label for="#q3-1">1/2</label>
                <input type="radio" name="q3" id="q3-1"> <br/>
                <label for="#q3-2"><math><msqrt><mi>3</mi></msqrt></math>/2</label>
                <input type="radio" name="q3" id="q3-2"> <br/>
                <label for="#q3-3"><math><msqrt><mi>3</mi></msqrt></math></label>
                <input type="radio" name="q3" id="q3-3"> <br/>
            </div>
            <div class="question", name="q4">
                <h2>1024 / 8</h2>
                <label for="#q4-1">64</label>
                <input type="radio" name="q4" id="q4-1"> <br/>
                <label for="#q4-2">128</label>
                <input type="radio" name="q4" id="q4-2"> <br/>
                <label for="#q4-3">256</label>
                <input type="radio" name="q4" id="q4-3"> <br/>
            </div>
            <div class="question", name="q5">
                <h2>13 x 26</h2>
                <label for="#q5-1">325</label>
                <input type="radio" name="q5" id="q5-1"> <br/>
                <label for="#q5-2">345</label>
                <input type="radio" name="q5" id="q5-2"> <br/>
                <label for="#q5-3">338</label>
                <input type="radio" name="q5" id="q5-3"> <br/>
            </div>
            <div class="question", name="q6">
                <h2>tan(45)</h2>
                <label for="#q6-1">-1</label>
                <input type="radio" name="q6" id="q6-1"> <br/>
                <label for="#q6-2">1</label>
                <input type="radio" name="q6" id="q6-2"> <br/>
                <label for="#q6-3">inf</label>
                <input type="radio" name="q6" id="q6-3"> <br/>
            </div>
        </div>

        <div class="endBlock">
            <label id="resultLabel">Finished?</label>
            <button name="submitBtn" onclick="submit();">Submit</button>
            
        </div>
    </body>
</html>